<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asher-Link | Dashboard</title>
    <link rel="stylesheet" href="styles/build.css">
    <link rel="stylesheet" href="styles/fontawesome/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-slate-50 min-h-screen">

    <div id="login-container" class="flex items-center justify-center min-h-screen">
        <div class="card w-full max-w-md shadow-2xl">
            <h2 class="text-3xl font-bold text-slate-900 mb-6 text-center">Account Sign In</h2>
            <form onsubmit="return doLogin()" class="space-y-6">
                <div class="relative">
                    <i class="fa fa-user absolute left-4 top-4 text-slate-400"></i>
                    <input type="text" id="username" placeholder="Username" class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div class="relative">
                    <i class="fa fa-lock absolute left-4 top-4 text-slate-400"></i>
                    <input type="password" id="password" placeholder="Password" class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <button type="submit" class="button button-primary w-full py-4 text-lg">ðŸ”‘ Sign in</button>
            </form>
            <p id="info-status" class="mt-4 text-center text-sm font-medium"></p>
        </div>
    </div>

    <div id="dashboard-container" class="hidden max-w-6xl mx-auto p-4 sm:p-8">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">Welcome, <span id="stat-user" class="text-blue-600">User</span></h1>
                <p class="text-slate-500"><i class="fa fa-circle text-green-500 animate-pulse mr-2"></i> Connected</p>
            </div>
            <button onclick="location.reload()" class="px-6 py-2 bg-slate-900 text-white rounded-full hover:bg-slate-700 transition-all shadow-lg">
                <i class="fa fa-sign-out-alt mr-2"></i> Log out
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4">
                <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600">
                    <i class="fa fa-cloud-download-alt text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm text-slate-500 font-medium uppercase tracking-wider">Total Used</p>
                    <h3 id="stat-used" class="text-2xl font-bold text-slate-900">0.00 GB</h3>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4">
                <div class="w-14 h-14 bg-green-50 rounded-2xl flex items-center justify-center text-green-600">
                    <i class="fa fa-battery-half text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm text-slate-500 font-medium uppercase tracking-wider">Remaining</p>
                    <h3 id="stat-rem" class="text-2xl font-bold text-slate-900">0.00 GB</h3>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4">
                <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center text-orange-600">
                    <i class="fa fa-clock text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm text-slate-500 font-medium uppercase tracking-wider">Active Time</p>
                    <h3 id="stat-uptime" class="text-2xl font-bold text-slate-900">00:00:00</h3>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                <h4 class="text-xl font-bold mb-6">Data Consumption</h4>
                <div class="h-64">
                    <canvas id="usageChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 flex flex-col justify-between">
                <div>
                    <h4 class="text-xl font-bold mb-2">Network Status</h4>
                    <p class="text-slate-500 mb-6">Your connection is optimized for streaming.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        async function doLogin() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const infoText = document.getElementById('info-status');

            infoText.innerText = "Authenticating secure session...";
            infoText.className = "mt-4 text-center text-sm font-medium text-blue-600";

            const MIKROTIK_API_URL = "http://12345678.sn.mynetname.net:8080/api/login";

            infoText.innerText = "Loading...";

            try {
                const response = await fetch(MIKROTIK_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, password: pass })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    document.getElementById('login-container').classList.add('hidden');
                    document.getElementById('dashboard-container').classList.remove('hidden');
                    
                    document.getElementById('stat-user').innerText = data.username;
                    document.getElementById('stat-used').innerText = data.used;
                    document.getElementById('stat-rem').innerText = data.remaining;
                    document.getElementById('stat-uptime').innerText = data.uptime || "Connected";

                    // Initialize Chart
                    initChart(parseFloat(data.used), parseFloat(data.remaining));
                } else {
                    infoText.innerText = data.message || "Invalid account details.";
                    infoText.className = "mt-4 text-center text-sm font-medium text-red-500";
                }
            } catch (err) {
                infoText.innerText = "Local Server Error: Check MikroTik Container.";
                infoText.className = "mt-4 text-center text-sm font-medium text-red-500";
            }
            return false;
        }

        function initChart(used, remaining) {
            const ctx = document.getElementById('usageChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Used (GB)', 'Remaining (GB)'],
                    datasets: [{
                        data: [used, remaining > 0 ? remaining : 0],
                        backgroundColor: ['#3b82f6', '#10b981'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    cutout: '70%'
                }
            });
        }
    </script>
</body>
</html>
